# AI Attribution Integration Guide

This guide explains how to integrate AI attribution into the existing GitHub automation system to differentiate between human and AI-generated comments.

## Problem Statement

Currently, all automated comments appear to come from the human user (dug-21) because they use the human's GitHub token for authentication. This makes it difficult to distinguish between human and AI-generated updates.

## Solution Overview

Since we cannot change the GitHub API authentication mechanism, we implement clear visual attribution within the comment body itself. Each AI-generated comment includes:

1. **Header**: Clear identification of the AI agent
2. **Content**: The actual message
3. **Footer**: Metadata tags and timestamp

## Components

### 1. AIAttribution Module (`ai-attribution.js`)

Provides core attribution functionality:
- Agent type definitions (Claude, ruv-swarm agents, etc.)
- Comment wrapping with headers/footers
- Metadata management
- AI comment detection

### 2. EnhancedGitHubClient (`enhanced-github-client.js`)

Extends GitHub API interactions with automatic attribution:
- `postComment()` - Automatically adds attribution
- `postProgressUpdate()` - Formatted progress with attribution
- `postError()` - Error messages with attribution
- `postMultiAgentComment()` - Multi-agent reports
- `getAIComments()` - Retrieve all AI-generated comments

### 3. Automation Patch (`automation-patch.js`)

Provides a wrapper to enhance existing automation classes:
- Preserves existing functionality
- Adds attribution to all comments
- Minimal code changes required

## Integration Steps

### Option 1: Direct Integration

1. Copy the attribution modules to your project:
```bash
cp issues/issue-10/ai-attribution.js ./
cp issues/issue-10/enhanced-github-client.js ./
```

2. Update your automation class to use EnhancedGitHubClient:

```javascript
const EnhancedGitHubClient = require('./enhanced-github-client');

class YourAutomation {
    constructor(config) {
        // ... existing code ...
        this.enhancedClient = new EnhancedGitHubClient(this.octokit, config);
    }
    
    async postComment(issueNumber, body, options = {}) {
        return this.enhancedClient.postComment(issueNumber, body, {
            agentType: 'CLAUDE', // or appropriate type
            ...options
        });
    }
}
```

### Option 2: Using the Patch

1. Import the patch function:
```javascript
const { enhanceWithAttribution } = require('./automation-patch');
```

2. Wrap your existing class:
```javascript
const EnhancedAutomation = enhanceWithAttribution(GitHubWorkflowAutomation);
const automation = new EnhancedAutomation(config);
```

### Option 3: Minimal Changes

For minimal changes to existing code, just update the postComment method:

```javascript
const AIAttribution = require('./ai-attribution');

class YourAutomation {
    constructor(config) {
        // ... existing code ...
        this.attribution = new AIAttribution();
    }
    
    async postComment(issueNumber, body) {
        // Add attribution wrapper
        const wrappedBody = this.attribution.wrapWithAttribution(
            body,
            'CLAUDE', // or appropriate agent type
            { automated: true }
        );
        
        return this.octokit.rest.issues.createComment({
            owner: this.config.github.owner,
            repo: this.config.github.repo,
            issue_number: issueNumber,
            body: wrappedBody
        });
    }
}
```

## Usage Examples

### Basic Comment with Attribution

```javascript
await client.postComment(
    issueNumber,
    "I've analyzed your issue and found a solution.",
    { agentType: 'CLAUDE' }
);
```

Result:
```
ðŸ¤– **Claude AI Assistant**

---
*This comment was generated by Claude (Anthropic)*
---

I've analyzed your issue and found a solution.

---
```
`ai-generated` `by-claude` `automated`
```
*Generated at: 2025-01-06T12:34:56Z*
*ðŸ¤– Claude AI Assistant | Powered by Anthropic*
```

### Progress Update

```javascript
await client.postProgressUpdate(issueNumber, {
    status: 'In Progress',
    phase: 'Implementation',
    percentage: 75,
    currentTask: 'Writing unit tests',
    updates: [
        'Completed core functionality',
        'Added error handling',
        'Starting test implementation'
    ]
}, 'SWARM_CODER');
```

### Multi-Agent Report

```javascript
await client.postMultiAgentComment(issueNumber, [
    {
        agentType: 'SWARM_RESEARCHER',
        content: 'Research findings...'
    },
    {
        agentType: 'SWARM_CODER',
        content: 'Implementation details...'
    }
]);
```

## Agent Types

The system supports the following agent types:

- `CLAUDE` - Claude AI Assistant
- `RUV_SWARM` - General swarm agent
- `SWARM_RESEARCHER` - Research-focused agent
- `SWARM_CODER` - Coding-focused agent
- `SWARM_ANALYST` - Analysis-focused agent
- `SWARM_COORDINATOR` - Coordination agent
- `AUTOMATION` - General automation system

## Testing

Run the test script to see examples:

```bash
# Test on issue #10 (default)
node test-ai-attribution.js

# Test on a specific issue
node test-ai-attribution.js 15
```

## Benefits

1. **Clear Differentiation**: Instantly identify AI vs human comments
2. **Agent Attribution**: Know which AI system generated each comment
3. **Metadata Tracking**: Session IDs, task IDs, timestamps
4. **Backward Compatible**: No breaking changes to existing code
5. **Searchable**: Comments are tagged for easy filtering

## Future Enhancements

1. **GitHub App**: Create a GitHub App that posts as a bot user
2. **Webhook Integration**: Track AI comments in external systems
3. **Analytics**: Generate reports on AI activity
4. **Custom Styling**: Use GitHub's markdown features for better formatting

## Configuration

Set these environment variables:

- `GITHUB_TOKEN` or `AGENT_TOKEN` - GitHub authentication token
- `AUTOMATION_ENABLED=true` - Enable automatic attribution
- `DEFAULT_AGENT_TYPE` - Default agent type (e.g., 'CLAUDE')

## Troubleshooting

### Comments not showing attribution

Check that:
1. The enhanced client is being used
2. `attribution: false` is not set in options
3. Agent type is properly specified

### Wrong agent type displayed

Ensure:
1. Correct agent type is passed to postComment
2. Agent type mapping is correct for your use case

### API rate limits

The enhanced client makes the same number of API calls as before. Attribution is added locally before posting.

## Support

For issues or questions:
1. Check the test examples in `test-ai-attribution.js`
2. Review the implementation in `ai-attribution.js`
3. Create an issue in the repository

---

This solution provides clear visual differentiation between human and AI-generated content while maintaining full backward compatibility with existing systems.